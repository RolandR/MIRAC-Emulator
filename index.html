<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<link href="./_css/mirac.css" rel="stylesheet" type="text/css" media="all">
		<title>
			MIRAC Emulator
		</title>
		
		<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon-180x180.png">
		<link rel="icon" type="image/png" href="./favicon-192x192.png" sizes="192x192">
		<link rel="icon" type="image/png" href="./favicon-160x160.png" sizes="160x160">
		<link rel="icon" type="image/png" href="./favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16">
		<link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32">
		
		<meta name="mobile-web-app-capable" content="yes" />
	</head>
	<body>
		<div id="centrificator">
			<div class="register">
				<h2>Program Ctr</h2>
				<div id="r1" class="registerValue"></div>
			</div><div class="register">
				<h2>Accumulator</h2>
				<div id="r0" class="registerValue"></div>
			</div><div class="register">
				<h2>Instruction</h2>
				<div id="r2" class="registerValue"></div>
			</div><div class="register">
				<h2>Argument Rg</h2>
				<div id="r3" class="registerValue"></div>
			</div><div class="register">
				<h2>ALU Operand</h2>
				<div id="r4" class="registerValue"></div>
			</div><div class="register">
				<h2>Address Bus</h2>
				<div id="r5" class="registerValue"></div>
			</div><div class="register">
				<h2>Data Bus In</h2>
				<div id="r6" class="registerValue"></div>
			</div><div class="register">
				<h2>DataBus Out</h2>
				<div id="r7" class="registerValue"></div>
			</div>
			<br />
			<div id="moreRegistersPanel">
				<div class="register">
					<h2>StackPointr</h2>
					<div id="r11" class="registerValue"></div>
				</div><div class="register">
					<h2>Gen.Purpose</h2>
					<div id="r100" class="registerValue" title="g0"></div>
					<div id="r101" class="registerValue" title="g1"></div>
					<div id="r102" class="registerValue" title="g2"></div>
					<div id="r103" class="registerValue" title="g3"></div>
					<div id="r104" class="registerValue" title="g4"></div>
					<div id="r105" class="registerValue" title="g5"></div>
					<div id="r106" class="registerValue" title="g6"></div>
					<div id="r107" class="registerValue" title="g7"></div>
				</div><div class="register">
					<h2>Device Addr</h2>
					<div id="r8" class="registerValue"></div>
				</div><div class="register">
					<h2>Device Din</h2>
					<div id="r9" class="registerValue"></div>
				</div><div class="register">
					<h2>Device Dout</h2>
					<div id="r10" class="registerValue"></div>
				</div>
			</div><div id="about">
				<img src="./Mirac-Logo.svg" id="miracLogo" width="320" alt="MIRAC Emulator"/>
				<br />
				<p>
					This is a JavaScript emulation of the<br />
					Minecraft Redstone Automatic Computer.
				</p>
				<p>
					Documentation about the architecture, instruction set, assembly language and other topics:<br />
					<a href="./docs/Mirac.pdf" target="_blank">Download</a> (pdf, 42k).
				</p>
				<p>
					Currently, not all planned instructions are implemented in the MIRAC CPU.
				</p>
				<p>
					<a href="https://github.com/RolandR/MIRAC-Emulator" target="_blank">Github Repository</a>. Made by <a href="http://rolandrytz.ch" target="_blank">Roland Rytz</a>.
				</p>
			</div><div id="romInput" class="panel">
				<h2><abbr title="MIDAS - Mirac Direct Assembly">MIDAS</abbr> Assembly Input<button id="biggerButton" onclick="Control.toggleEditorSize();"></button></h2>
				<div id="#romLines">
				</div>
				<div id="romTextContainer"><!--TextAreas are bugged-->
					<textarea
						id="romText"
						spellcheck="false"
						oninput="setTimeout(editor.onEdit)"
						onkeydown="setTimeout(editor.onEdit);"
						onkeyup="editor.onEdit();"
						onpaste="setTimeout(editor.onEdit);"
						onmouseup="editor.onEdit();"
						onscroll="editor.onScroll();"
					>ldai #11000000
pdai 031
$drawLineLoop:
pdwa
inca
comp #11010000
brns $drawLineLoop

ldai 003 // GPA is x
cpaa
ldai 007 // GPB is y
cpab
ldai 000 // GPC is direction
         // 000: up right
         // 001: down right
         // 002: down left
         // 003: up left
cpac

$moveLoop:
jsrt $move
jmpi $moveLoop

$move:
rdac
comp 000
brzs $moveUpRight
comp 001
brzs $moveDownRight
comp 002
brzs $moveDownLeft
comp 003
brzs $moveUpLeft
$moveUpRight:
ldai 001
opra
rdab
subt
cpab

ldai 001
opra
rdaa
addc
cpaa

jmpi $resumeMove

$moveDownRight:
ldai 001
opra
rdab
addc
cpab

ldai 001
opra
rdaa
addc
cpaa

jmpi $resumeMove

$moveDownLeft:
ldai 001
opra
rdab
addc
cpab

ldai 001
opra
rdaa
subt
cpaa

jmpi $resumeMove

$moveUpLeft:
ldai 001
opra
rdab
subt
cpab

ldai 001
opra
rdaa
subt
cpaa

jmpi $resumeMove

$resumeMove:
jsrt $erase
jsrt $draw

rdab
comp #00001011
psha
srnz $bottomBounce
pula
comp 001
srns $topBounce

rdaa
comp #00001111
psha
srnz $rightBounce
pula
comp 001
srns $leftBounce

$endMove:

rsrt

$topBounce:
    rdac
    comp 000 // Currently going up right
    brzz $changeDownLeft
    ldai 001
    jmpi $endTopBounce
    $changeDownLeft:
    ldai 002
    $endTopBounce:
    cpac
rsrt

$bottomBounce:
    rdac
    comp 001 // Currently going down right
    brzz $changeUpLeft
    ldai 000
    jmpi $endTopBounce
    $changeUpLeft:
    ldai 003
    $endBottomBounce:
    cpac
rsrt

$leftBounce:
    rdac
    comp 003 // Currently going up left
    brzz $changeDownRight
    ldai 000
    jmpi $endLeftBounce
    $changeDownRight:
    ldai 001
    $endLeftBounce:
    cpac
rsrt

$rightBounce:
    rdac
    comp 000 // Currently going up right
    brzz $changeDownLeft
    ldai 003
    jmpi $endRightBounce
    $changeDownLeft:
    ldai 002
    $endRightBounce:
    cpac
rsrt

$draw:
    pdai 031
    rdab
    cpae
    opra
    ldai #00010000
    mult
    opra
    rdaa
    cpad
    addc
    pdwa
rsrt

$erase:
    pdai 032
    rdae
    opra
    ldai #00010000
    mult
    opra
    rdad
    addc
    pdwa
rsrt






</textarea>
				</div>
				<div id="romDisplay" contenteditable="true"></div>
				<div id="romControls">
					<button id="loadRamButton" onclick="Control.loadToRam();">Load to RAM</button>
					<span id="atAddress"> starting at octal address </span>
					<input id="loadToAddress" type="text" value="0">
				</div>
			</div>
			<br />
			<div id="leftpanel"><div id="ram" class="panel">
				<h2>Memory</h2>
				<table id="ramtable" class="memtable">
					<tbody id="ramtbody"></tbody>
				</table>
			</div><br /><div id="octalDisplay" class="panel">
				<h2 title="Device Address: 020">Oct Display</h2>
				<div class="displayContainer">
					<div class="displaySegment" id="displaySegment0"></div><div class="displaySegment" id="displaySegment1"></div><div class="displaySegment" id="displaySegment2"></div>
				</div>
				<span class="peripheryDocs" onclick="Control.showPopup('octalDisplayInfoPopup');">Docs</span>
			</div><div id="dotMatrix" class="panel">
				<h2 title="Device Addresses: 030 - 034">Dot Matrix</h2>
				<div class="dotMatrixContainer">
					<canvas id="dotMatrixCanvas" height="160" width="160"></canvas>
				</div>
				<span class="peripheryDocs" onclick="Control.showPopup('dotMatrixInfoPopup');">Docs</span>
			</div><div id="asciiDisplay" class="panel">
				<h2 title="Device Address: 040">ASCII Display</h2>
				<div class="asciiDisplayContainer">
					<span id="displayChar0">
					</span><span id="displayChar1">
					</span><span id="displayChar2">
					</span><span id="displayChar3">
					</span><span id="displayChar4">
					</span><span id="displayChar5">
					</span><span id="displayChar6">
					</span><span id="displayChar7">
					</span><span id="displayChar8">
					</span><span id="displayChar9">
					</span></div>
				<span class="peripheryDocs" onclick="Control.showPopup('asciiDisplayInfoPopup');">Docs</span>
			</div></div><div id="rightpanel"><div id="control" class="rightPanelDiv panel">
				<h2>Control</h2>
				<button id="run" class="runButton" onclick="Control.toggleRun()">Start</button><!-- Maaaaan, why does html interpret line breaks? Even for inline elements, that's somewhat silly.
			 --><button id="cycle" onclick="Control.cycle();" title="Single cycle step.">Step</button><!--
			 --><button id="resetpc" onclick="Control.reset();" title="Clears registers and flags.">Reset to start</button><!--
			 --><button id="resetmem" onclick="Control.hardReset();" title="Clears memory and all registers and flags.">Hard reset</button><!--
			 --><hr /><!--
			 --><span class="controlValueLabel">Cycle interval: </span><!--
			 --><input class="controlValue" id="cycleInterval" type="number" value="200" /><!--
			 --><button class="controlValueButton" id="cycleIntervalButton" onclick="Control.updateCycleInterval();">Apply</button><!--
			 --><hr /><!--
			 --><span class="controlValueLabel">Set PC (octal): </span><!--
			 --><input class="controlValue" id="setPC" type="text" value="0" /><!--
			 --><button class="controlValueButton" id="setPCButton" onclick="Control.setPC();">Apply</button><!--
			 --><hr /><!--
			 --><span class="controlValueLabel" id="frequencyLabel">Running at: </span><!--
			 --><span class="controlValueLabel" id="frequency" title="Breathtaking speeds!">(Paused)</span><!--
			 --><hr /><!--
			 --><span class="controlValueLabel">Use animations: </span><!--
			 --><input class="controlValue" id="useAnimations" type="checkbox" checked="true" onclick="Control.updateUseAnimations();" />
			 
			 
			 </div><div id="flags" class="rightPanelDiv panel">
				<h2>Flags</h2>
				<table id="flagtable">
					<tbody>
						<tr>
							<td>Carry</td>
							<td>Zero</td>
							<td>Overflow</td>
							<td>Negative</td>
						</tr>
						<tr>
							<td id="f0" class="">0</td>
							<td id="f1" class="">0</td>
							<td id="f2" class="">0</td>
							<td id="f3" class="">0</td>
						</tr>
					</tbody>
				</table>
			</div><div id="stack" class="rightPanelDiv panel">
				<h2>Call Stack</h2>
				<table id="stacktable" class="memtable">
					<tbody id="stacktbody"></tbody>
				</table>
			</div>
			<div id="rdLogoContainer">
				<a href="http://rolandrytz.ch">
					<img src="./RedstoneDigital-Logo.svg" id="rdLogo" width="320" alt="Redstone Digital"/>
				</a>
			</div>
			</div>
		</div>
		<div id="popupOverlay">
			<div id="overlayContainer">
				<div class="popup" id="octalDisplayInfoPopup">
					<h2>Info: Octal Display <button class="popupCloseButton" onclick="Control.hidePopup(this.parentElement.parentElement.id);">x</button></h2>
				</div>
				<div class="popup" id="dotMatrixInfoPopup">
					<h2>Info: Dot Matrix <button class="popupCloseButton" onclick="Control.hidePopup(this.parentElement.parentElement.id);">x</button></h2>
				</div>
				<div class="popup" id="asciiDisplayInfoPopup">
					<h2>Info: ASCII Display <button class="popupCloseButton" onclick="Control.hidePopup(this.parentElement.parentElement.id);">x</button></h2>
				</div>
			</div>
		</div>
		
		
		
		<script type="text/javascript" src="./_js/setZeroTimeout.js"></script>
		
		<script type="text/javascript" src="./_js/Config.js"></script>
		
		<script type="text/javascript" src="./_js/Conversions.js"></script>
		<script type="text/javascript" src="./_js/Register.js"></script>
		<script type="text/javascript" src="./_js/Flag.js"></script>
		<script type="text/javascript" src="./_js/Mem.js"></script>
		<script type="text/javascript" src="./_js/Mirac.js"></script>
		<script type="text/javascript" src="./_js/ALU.js"></script>
		
		<script type="text/javascript" src="./_js/OctalDisplay.js"></script>
		<script type="text/javascript" src="./_js/DotMatrix.js"></script>
		<script type="text/javascript" src="./_js/AsciiDisplay.js"></script>
		<script type="text/javascript" src="./_js/Devices.js"></script>
		
		<script type="text/javascript" src="./_js/Ins.js"></script>
		<script type="text/javascript" src="./_js/Opcode.js"></script>
		<script type="text/javascript" src="./_js/Opcodes.js"></script>
		
		<script type="text/javascript" src="./_js/Assembler.js"></script>
		<script type="text/javascript" src="./_js/Control.js"></script>
		<script type="text/javascript" src="./_js/Editor.js"></script>
		<script type="text/javascript" src="./_js/Emulator.js"></script>
	</body>
</html>
