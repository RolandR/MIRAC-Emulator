<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<link href="./_css/mirac.css" rel="stylesheet" type="text/css" media="all">
		<title>
			MIRAC Emulator
		</title>
		
		<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon-180x180.png">
		<link rel="icon" type="image/png" href="./favicon-192x192.png" sizes="192x192">
		<link rel="icon" type="image/png" href="./favicon-160x160.png" sizes="160x160">
		<link rel="icon" type="image/png" href="./favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16">
		<link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32">
		
		
	</head>
	<body>
		<div id="centrificator">
			<div class="register">
				<h2>Program Ctr</h2>
				<div id="r1" class="registerValue"></div>
			</div><div class="register">
				<h2>Accumulator</h2>
				<div id="r0" class="registerValue"></div>
			</div><div class="register">
				<h2>Instruction</h2>
				<div id="r2" class="registerValue"></div>
			</div><div class="register">
				<h2>Argument Rg</h2>
				<div id="r3" class="registerValue"></div>
			</div><div class="register">
				<h2>ALU Operand</h2>
				<div id="r4" class="registerValue"></div>
			</div><div class="register">
				<h2>Address Bus</h2>
				<div id="r5" class="registerValue"></div>
			</div><div class="register">
				<h2>Data Bus In</h2>
				<div id="r6" class="registerValue"></div>
			</div><div class="register">
				<h2>DataBus Out</h2>
				<div id="r7" class="registerValue"></div>
			</div>
			<br />
			<div id="moreRegistersPanel">
				<div class="register">
					<h2>StackPointr</h2>
					<div id="r11" class="registerValue"></div>
				</div><div class="register">
					<h2>Gen.Purpose</h2>
					<div id="r100" class="registerValue" title="g0"></div>
					<div id="r101" class="registerValue" title="g1"></div>
					<div id="r102" class="registerValue" title="g2"></div>
					<div id="r103" class="registerValue" title="g3"></div>
					<div id="r104" class="registerValue" title="g4"></div>
					<div id="r105" class="registerValue" title="g5"></div>
					<div id="r106" class="registerValue" title="g6"></div>
					<div id="r107" class="registerValue" title="g7"></div>
				</div><div class="register">
					<h2>Device Addr</h2>
					<div id="r8" class="registerValue"></div>
				</div><div class="register">
					<h2>Device Din</h2>
					<div id="r9" class="registerValue"></div>
				</div><div class="register">
					<h2>Device Dout</h2>
					<div id="r10" class="registerValue"></div>
				</div>
			</div><div id="about">
				<img src="./Mirac-Logo.svg" id="miracLogo" width="320" alt="MIRAC Emulator"/>
				<br />
				<p>
					This is a JavaScript emulation of the<br />
					Minecraft Redstone Automatic Computer.
				</p>
				<p>
					Documentation about the architecture, instruction set, assembly language and other topics:<br />
					<a href="./docs/Mirac.pdf" target="_blank">Download</a> (pdf, 42k).
				</p>
				<p>
					Currently, not all planned instructions are implemented in the MIRAC CPU.
				</p>
				<p>
					<a href="https://github.com/RolandR/MIRAC-Emulator" target="_blank">Github Repository</a>. Made by <a href="http://rolandrytz.ch" target="_blank">Roland Rytz</a>.
				</p>
			</div><div id="romInput" class="panel">
				<h2><abbr title="MIDAS - Mirac Direct Assembly">MIDAS</abbr> Assembly Input<button id="biggerButton" onclick="Control.toggleEditorSize();"></button></h2>
				<div id="#romLines">
				</div>
				<div id="romTextContainer"><!--TextAreas are bugged-->
					<textarea
						id="romText"
						spellcheck="false"
						oninput="setTimeout(editor.onEdit)"
						onkeydown="setTimeout(editor.onEdit);"
						onkeyup="editor.onEdit();"
						onpaste="setTimeout(editor.onEdit);"
						onmouseup="editor.onEdit();"
						onscroll="editor.onScroll();"
					>// Sample program demonstrating the stack and other
// features of MIRAC

$start:
JSRT $doSomething  // Jump to subroutine
LDAI 000           // Load 000 to accumulator
WRAI $recursion    // Write accumulator to $recursion
JMPI $start        // Jump to start

$doSomething:
LDAM $recursion    // Load value at $recursion to accu
OPRA               // Accumulator to operand register
LDAI 001           // Load 001 to accu
ADDC               // Add accu and operand
WRAI $recursion    // Write result to $recursion
OPRA               // Accumulator to operand register
LDAI #11111000     // Load -8 to accumulator
ADDC               // Add
BRZS $skip         // If accu -8 = 0, skip to $skip
JSRT $doSomething  // Else, jump to subroutine
$skip:
RSRT               // Return from subroutine

$recursion: 000



</textarea>
				</div>
				<div id="romDisplay" contenteditable="true"></div>
				<div id="romControls">
					<button id="loadRamButton" onclick="Control.loadToRam();">Load to RAM</button>
					<span id="atAddress"> starting at octal address </span>
					<input id="loadToAddress" type="number" value="0">
				</div>
			</div>
			<br />
			<div id="leftpanel"><div id="ram" class="panel">
				<h2>Memory</h2>
				<table id="ramtable" class="memtable">
					<tbody id="ramtbody"></tbody>
				</table>
			</div><!--br /><div id="monitor" class="panel">
				Monitor!
			</div--></div><div id="rightpanel"><div id="control" class="rightPanelDiv panel">
				<h2>Control</h2>
				<button id="run" class="runButton" onclick="Control.toggleRun()">Start</button><!-- Maaaaan, why does html interpret line breaks? Even for inline elements, that's somewhat silly.
			 --><button id="cycle" onclick="Control.cycle();" title="Single cycle step.">Step</button><!--
			 --><button id="resetpc" onclick="Control.reset();" title="Clears registers and flags.">Reset to start</button><!--
			 --><button id="resetmem" onclick="Control.hardReset();" title="Clears memory and all registers and flags.">Hard reset</button>
				<hr />
				<span class="controlValueLabel">Cycle interval: </span><!--
			 --><input class="controlValue" id="cycleInterval" type="number" value="200" /><!--
			 --><button class="controlValueButton" id="cycleIntervalButton" onclick="Control.updateCycleInterval();">Apply</button><!--
			 --><hr />
				<span class="controlValueLabel">Set PC (octal): </span><!--
			 --><input class="controlValue" id="setPC" type="number" value="0" /><!--
			 --><button class="controlValueButton" id="setPCButton" onclick="Control.setPC();">Apply</button><!--
			 --><hr />
				<span class="controlValueLabel" id="frequencyLabel">Running at: </span><!--
			 --><span class="controlValueLabel" id="frequency" title="Breathtaking speeds!">(Paused)</span>
			 
			 </div><div id="flags" class="rightPanelDiv panel">
				<h2>Flags</h2>
				<table id="flagtable">
					<tbody>
						<tr>
							<td>Carry</td>
							<td>Zero</td>
							<td>Overflow</td>
							<td>Negative</td>
						</tr>
						<tr>
							<td id="f0" class="">0</td>
							<td id="f1" class="">0</td>
							<td id="f2" class="">0</td>
							<td id="f3" class="">0</td>
						</tr>
					</tbody>
				</table>
			</div><div id="stack" class="rightPanelDiv panel">
				<h2>Call Stack</h2>
				<table id="stacktable" class="memtable">
					<tbody id="stacktbody"></tbody>
				</table>
			</div>
			<div id="rdLogoContainer">
				<a href="http://rolandrytz.ch">
					<img src="./RedstoneDigital-Logo.svg" id="rdLogo" width="320" alt="Redstone Digital"/>
				</a>
			</div>
			</div>
		</div>
		<script type="text/javascript" src="./_js/Conversions.js"></script>
		<script type="text/javascript" src="./_js/Register.js"></script>
		<script type="text/javascript" src="./_js/Flag.js"></script>
		<script type="text/javascript" src="./_js/Mem.js"></script>
		<script type="text/javascript" src="./_js/Mirac.js"></script>
		<script type="text/javascript" src="./_js/ALU.js"></script>
		<script type="text/javascript" src="./_js/Ins.js"></script>
		<script type="text/javascript" src="./_js/Opcode.js"></script>
		<script type="text/javascript" src="./_js/Opcodes.js"></script>
		
		<script type="text/javascript" src="./_js/Assembler.js"></script>
		<script type="text/javascript" src="./_js/Config.js"></script>
		<script type="text/javascript" src="./_js/Control.js"></script>
		<script type="text/javascript" src="./_js/Editor.js"></script>
		<script type="text/javascript" src="./_js/Emulator.js"></script>
	</body>
</html>
